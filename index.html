<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>三角洲行动随机装备</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#1a365d',
            accent: '#fc814a',
            dark: '#17202a',
            neon: '#00f7ff'
          }
        }
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .btn-touch {
        min-height: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card-mobile {
        background: rgba(23, 32, 42, 0.85);
        backdrop-filter: blur(4px);
      }
    }
  </style>
</head>
<body class="bg-dark text-white min-h-screen p-3">
  <!-- 标题区域 -->
  <div class="text-center mb-4">
    <h1 class="text-[clamp(1.4rem,6vw,2rem)] font-bold text-neon mb-2">三角洲行动随机装备</h1>
    <div class="w-32 h-1 bg-accent mx-auto rounded-full mb-3"></div>
    
    <!-- 模式选择 -->
    <div class="flex gap-2 mb-3">
      <button onclick="setMode('random')" class="flex-1 bg-primary text-white py-2 rounded btn-touch text-sm" id="randomMode">
        随机
      </button>
      <button onclick="setMode('balanced')" class="flex-1 bg-neon text-dark py-2 rounded btn-touch text-sm font-bold" id="balancedMode">
        均衡
      </button>
      <button onclick="setMode('aggressive')" class="flex-1 bg-primary text-white py-2 rounded btn-touch text-sm" id="aggressiveMode">
        猛攻
      </button>
    </div>
  </div>

  <!-- 主内容区 -->
  <div class="space-y-4 mb-6">
    <!-- 头盔 -->
    <div class="card-mobile rounded-lg p-3 border border-gray-700">
      <h2 class="text-lg font-bold text-accent mb-2 flex items-center">
        <i class="fa fa-shield mr-2"></i>头盔
      </h2>
      <div class="bg-gray-800 rounded-md overflow-hidden mb-3 aspect-[4/3] flex items-center justify-center">
        <img id="helmetImage" src="" alt="头盔" class="max-w-[80%] max-h-[80%] hidden">
        <div id="helmetPlaceholder" class="text-center">
          <i class="fa fa-helmet-battle text-4xl mb-2 text-gray-500"></i>
          <p class="text-gray-500 text-sm">点击获取装备</p>
        </div>
      </div>
      <button onclick="randomizeSingle('helmet', 25)" 
              class="w-full bg-primary hover:bg-primary/80 text-white py-3 rounded btn-touch flex items-center justify-center">
        <i class="fa fa-refresh mr-2"></i> 刷新头盔
        <span class="ml-2 bg-accent text-dark px-2 py-0.5 rounded text-xs" id="helmetCount">3次</span>
      </button>
    </div>
    
    <!-- 护甲 -->
    <div class="card-mobile rounded-lg p-3 border border-gray-700">
      <h2 class="text-lg font-bold text-accent mb-2 flex items-center">
        <i class="fa fa-user-shield mr-2"></i>护甲
      </h2>
      <div class="bg-gray-800 rounded-md overflow-hidden mb-3 aspect-[4/3] flex items-center justify-center">
        <img id="armorImage" src="" alt="护甲" class="max-w-[80%] max-h-[80%] hidden">
        <div id="armorPlaceholder" class="text-center">
          <i class="fa fa-shield-alt text-4xl mb-2 text-gray-500"></i>
          <p class="text-gray-500 text-sm">点击获取装备</p>
        </div>
      </div>
      <button onclick="randomizeSingle('armor', 25)" 
              class="w-full bg-primary hover:bg-primary/80 text-white py-3 rounded btn-touch flex items-center justify-center">
        <i class="fa fa-refresh mr-2"></i> 刷新护甲
        <span class="ml-2 bg-accent text-dark px-2 py-0.5 rounded text-xs" id="armorCount">3次</span>
      </button>
    </div>
    
    <!-- 枪械 -->
    <div class="card-mobile rounded-lg p-3 border border-gray-700">
      <h2 class="text-lg font-bold text-accent mb-2 flex items-center">
        <i class="fa fa-crosshairs mr-2"></i>枪械
      </h2>
      <div class="bg-gray-800 rounded-md overflow-hidden mb-3 aspect-[4/3] flex items-center justify-center">
        <img id="gunImage" src="" alt="枪械" class="max-w-[80%] max-h-[80%] hidden">
        <div id="gunPlaceholder" class="text-center">
          <i class="fa fa-firearms text-4xl mb-2 text-gray-500"></i>
          <p class="text-gray-500 text-sm">点击获取装备</p>
        </div>
      </div>
      <button onclick="randomizeSingle('gun', 59)" 
              class="w-full bg-primary hover:bg-primary/80 text-white py-3 rounded btn-touch flex items-center justify-center">
        <i class="fa fa-refresh mr-2"></i> 刷新枪械
        <span class="ml-2 bg-accent text-dark px-2 py-0.5 rounded text-xs" id="gunCount">3次</span>
      </button>
    </div>
  </div>
  
  <!-- 底部按钮区 -->
  <div class="fixed bottom-3 left-3 right-3 z-10">
    <button onclick="randomizeAll()" 
            class="w-full bg-accent hover:bg-accent/90 text-dark font-bold py-3 rounded btn-touch flex items-center justify-center relative"
            id="allBtn">
      <i class="fa fa-random mr-2"></i> 随机全部装备
      <span class="ml-2 bg-dark text-white px-2 py-0.5 rounded text-xs" id="allCooldown">30s</span>
    </button>
    
    <!-- 功能按钮 -->
    <div class="flex gap-2 mt-2">
      <button onclick="showRulesModal()" class="flex-1 bg-gray-700 hover:bg-gray-600 text-white py-2 rounded btn-touch text-sm">
        <i class="fa fa-info-circle mr-1"></i> 规则
      </button>
      <button onclick="showAdminModal()" class="flex-1 bg-gray-700 hover:bg-gray-600 text-white py-2 rounded btn-touch text-sm">
        <i class="fa fa-key mr-1"></i> 重置
      </button>
    </div>
  </div>

  <!-- 规则模态框 -->
  <div id="rulesModal" class="fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 hidden">
    <div class="bg-dark border border-neon rounded-lg p-4 max-w-md w-full max-h-[80vh] overflow-y-auto">
      <h3 class="text-lg font-bold text-neon mb-3">使用规则</h3>
      <div class="space-y-2 text-sm">
        <p><strong>1. 装备类型</strong></p>
        <ul class="list-disc pl-5 mb-2">
          <li>头盔（25种）</li>
          <li>护甲（25种）</li>
          <li>枪械（59种）</li>
        </ul>
        
        <p><strong>2. 模式说明</strong></p>
        <ul class="list-disc pl-5 mb-2">
          <li>随机：所有装备概率均等</li>
          <li>均衡：中间等级装备概率高</li>
          <li>猛攻：高等级装备概率高</li>
        </ul>
        
        <p><strong>3. 限制</strong></p>
        <ul class="list-disc pl-5">
          <li>单类装备每小时可刷新3次</li>
          <li>全部刷新有30秒冷却</li>
        </ul>
      </div>
      <button onclick="hideRulesModal()" class="mt-4 w-full bg-accent text-dark py-2 rounded">关闭</button>
    </div>
  </div>

  <!-- 管理员模态框 -->
  <div id="adminModal" class="fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 hidden">
    <div class="bg-dark border border-neon rounded-lg p-4 max-w-md w-full">
      <h3 class="text-lg font-bold text-neon mb-3 text-center">管理员密码</h3>
      <input type="password" id="adminPassword" placeholder="输入密码" 
             class="w-full bg-gray-800 border border-gray-700 rounded p-2 mb-3 text-white">
      <div class="flex gap-2">
        <button onclick="verifyPassword()" class="flex-1 bg-accent text-dark py-2 rounded">确认</button>
        <button onclick="hideAdminModal()" class="flex-1 bg-gray-700 text-white py-2 rounded">取消</button>
      </div>
      <p id="passwordError" class="text-red-500 text-xs mt-2 text-center hidden">密码错误</p>
    </div>
  </div>

  <script>
    let currentMode = 'balanced';
    
    // 初始化存储
    function initStorage() {
      const now = Date.now();
      
      ['helmet', 'armor', 'gun'].forEach(type => {
        const storedData = localStorage.getItem(`cooldown_${type}`);
        if (!storedData) {
          localStorage.setItem(`cooldown_${type}`, JSON.stringify({
            count: 3,
            resetTime: now + 3600000
          }));
        } else {
          const data = JSON.parse(storedData);
          if (now > data.resetTime) {
            data.count = 3;
            data.resetTime = now + 3600000;
            localStorage.setItem(`cooldown_${type}`, JSON.stringify(data));
          }
        }
      });
      
      if (!localStorage.getItem('allLastUsed')) {
        localStorage.setItem('allLastUsed', 0);
      }
      
      updateButtonStates();
    }
    
    // 更新按钮状态
    function updateButtonStates() {
      const now = Date.now();
      
      // 更新单个按钮
      ['helmet', 'armor', 'gun'].forEach(type => {
        const data = JSON.parse(localStorage.getItem(`cooldown_${type}`));
        const btn = document.getElementById(`${type}Btn`);
        const countEl = document.getElementById(`${type}Count`);
        
        countEl.textContent = `${data.count}次`;
        
        if (data.count <= 0 && (now < data.resetTime)) {
          btn.disabled = true;
          btn.classList.add('opacity-50');
        } else {
          btn.disabled = false;
          btn.classList.remove('opacity-50');
        }
      });
      
      // 更新全部按钮
      const allLastUsed = parseInt(localStorage.getItem('allLastUsed'));
      const allBtn = document.getElementById('allBtn');
      const allCooldownEl = document.getElementById('allCooldown');
      
      if (now - allLastUsed < 30000) {
        const remaining = Math.ceil((30000 - (now - allLastUsed)) / 1000);
        allBtn.disabled = true;
        allBtn.classList.add('opacity-50');
        allCooldownEl.textContent = `${remaining}s`;
      } else {
        allBtn.disabled = false;
        allBtn.classList.remove('opacity-50');
        allCooldownEl.textContent = '30s';
      }
    }
    
    setInterval(updateButtonStates, 1000);
    
    // 模式切换
    function setMode(mode) {
      currentMode = mode;
      
      ['random', 'balanced', 'aggressive'].forEach(m => {
        const btn = document.getElementById(`${m}Mode`);
        if (m === mode) {
          btn.classList.remove('bg-primary', 'text-white');
          btn.classList.add('bg-neon', 'text-dark', 'font-bold');
        } else {
          btn.classList.remove('bg-neon', 'text-dark', 'font-bold');
          btn.classList.add('bg-primary', 'text-white');
        }
      });
    }
    
    // 模态框控制
    function showRulesModal() {
      document.getElementById('rulesModal').classList.remove('hidden');
    }
    
    function hideRulesModal() {
      document.getElementById('rulesModal').classList.add('hidden');
    }
    
    function showAdminModal() {
      document.getElementById('adminModal').classList.remove('hidden');
      document.getElementById('adminPassword').value = '';
      document.getElementById('passwordError').classList.add('hidden');
    }
    
    function hideAdminModal() {
      document.getElementById('adminModal').classList.add('hidden');
    }
    
    // 密码验证
    function verifyPassword() {
      if (document.getElementById('adminPassword').value === 'admin') {
        const now = Date.now();
        ['helmet', 'armor', 'gun'].forEach(type => {
          localStorage.setItem(`cooldown_${type}`, JSON.stringify({
            count: 3,
            resetTime: now + 3600000
          }));
        });
        localStorage.setItem('allLastUsed', 0);
        updateButtonStates();
        hideAdminModal();
        alert('已重置所有冷却');
      } else {
        document.getElementById('passwordError').classList.remove('hidden');
      }
    }
    
    // 图片路径
    const imagePaths = {
      helmet: './toukiu/toukiu (',
      armor: './hujia/huajia (',
      gun: './qiangxie/qiangxie ('
    };
    
    // 随机生成逻辑
    function getWeightedNum(type, max) {
      if (currentMode === 'random') {
        return Math.floor(Math.random() * max) + 1;
      }
      
      const weights = [];
      for (let i = 1; i <= max; i++) {
        let weight = 3;
        
        // 根据模式调整权重
        if (type !== 'gun') {
          if (currentMode === 'balanced' && i >= 10 && i <= 20) weight += 2;
          if (currentMode === 'aggressive' && i >= 15 && i <= 25) weight += 3;
        } else {
          if (currentMode === 'balanced' && i >= 20 && i <= 40) weight += 2;
          if (currentMode === 'aggressive' && i >= 30 && i <= 59) weight += 3;
        }
        
        weights.push({num: i, weight});
      }
      
      const total = weights.reduce((sum, item) => sum + item.weight, 0);
      let random = Math.random() * total;
      let cumulative = 0;
      
      for (let item of weights) {
        cumulative += item.weight;
        if (random < cumulative) return item.num;
      }
      
      return Math.floor(Math.random() * max) + 1;
    }
    
    // 加载图片
    function loadImage(type, num) {
      const img = document.getElementById(`${type}Image`);
      const placeholder = document.getElementById(`${type}Placeholder`);
      const path = `${imagePaths[type]}${num}).png`;
      
      img.onload = () => {
        placeholder.classList.add('hidden');
        img.classList.remove('hidden');
      };
      
      img.onerror = () => {
        alert(`图片加载失败: ${path}`);
      };
      
      img.src = path;
    }
    
    // 单个刷新
    function randomizeSingle(type, max) {
      const data = JSON.parse(localStorage.getItem(`cooldown_${type}`));
      if (data.count <= 0) return;
      
      data.count--;
      localStorage.setItem(`cooldown_${type}`, JSON.stringify(data));
      
      let num;
      if (type === 'helmet') {
        const armorSrc = document.getElementById('armorImage').src;
        const armorNum = armorSrc ? parseInt(armorSrc.match(/huajia \((\d+)\)/)?.[1] || 1) : 1;
        num = getWeightedNum(type, max);
      } else {
        num = getWeightedNum(type, max);
      }
      
      loadImage(type, num);
      updateButtonStates();
    }
    
    // 全部刷新
    function randomizeAll() {
      const now = Date.now();
      if (now - parseInt(localStorage.getItem('allLastUsed')) < 30000) return;
      
      localStorage.setItem('allLastUsed', now);
      
      // 刷新护甲
      const armorNum = getWeightedNum('armor', 25);
      loadImage('armor', armorNum);
      
      // 150ms后刷新头盔
      setTimeout(() => {
        const helmetNum = getWeightedNum('helmet', 25);
        loadImage('helmet', helmetNum);
      }, 150);
      
      // 300ms后刷新枪械
      setTimeout(() => {
        const gunNum = getWeightedNum('gun', 59);
        loadImage('gun', gunNum);
      }, 300);
      
      updateButtonStates();
    }
    
    // 初始化
    window.onload = initStorage;
  </script>
</body>
</html>
